<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class MiniPortile - mini_portile2-2.8.7 Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
  var index_rel_prefix = "./";
</script>

<script src="./js/navigation.js" defer></script>
<script src="./js/search.js" defer></script>
<script src="./js/search_index.js" defer></script>
<script src="./js/searcher.js" defer></script>
<script src="./js/darkfish.js" defer></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">




<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">Object
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-darwin-3F">::darwin?</a>
    
    <li ><a href="#method-c-freebsd-3F">::freebsd?</a>
    
    <li ><a href="#method-c-linux-3F">::linux?</a>
    
    <li ><a href="#method-c-mingw-3F">::mingw?</a>
    
    <li ><a href="#method-c-mswin-3F">::mswin?</a>
    
    <li ><a href="#method-c-native_path">::native_path</a>
    
    <li ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-c-openbsd-3F">::openbsd?</a>
    
    <li ><a href="#method-c-posix_path">::posix_path</a>
    
    <li ><a href="#method-c-solaris-3F">::solaris?</a>
    
    <li ><a href="#method-c-target_cpu">::target_cpu</a>
    
    <li ><a href="#method-c-target_os">::target_os</a>
    
    <li ><a href="#method-c-windows-3F">::windows?</a>
    
    <li ><a href="#method-i-activate">#activate</a>
    
    <li ><a href="#method-i-apply_patch">#apply_patch</a>
    
    <li ><a href="#method-i-archives_path">#archives_path</a>
    
    <li ><a href="#method-i-cc_cmd">#cc_cmd</a>
    
    <li ><a href="#method-i-compile">#compile</a>
    
    <li ><a href="#method-i-computed_options">#computed_options</a>
    
    <li ><a href="#method-i-configure">#configure</a>
    
    <li ><a href="#method-i-configure_defaults">#configure_defaults</a>
    
    <li ><a href="#method-i-configure_options">#configure_options</a>
    
    <li ><a href="#method-i-configure_prefix">#configure_prefix</a>
    
    <li ><a href="#method-i-configured-3F">#configured?</a>
    
    <li ><a href="#method-i-cook">#cook</a>
    
    <li ><a href="#method-i-cxx_cmd">#cxx_cmd</a>
    
    <li ><a href="#method-i-detect_host">#detect_host</a>
    
    <li ><a href="#method-i-download">#download</a>
    
    <li ><a href="#method-i-download_file">#download_file</a>
    
    <li ><a href="#method-i-download_file_file">#download_file_file</a>
    
    <li ><a href="#method-i-download_file_ftp">#download_file_ftp</a>
    
    <li ><a href="#method-i-download_file_http">#download_file_http</a>
    
    <li ><a href="#method-i-downloaded-3F">#downloaded?</a>
    
    <li ><a href="#method-i-execute">#execute</a>
    
    <li ><a href="#method-i-extract">#extract</a>
    
    <li ><a href="#method-i-extract_file">#extract_file</a>
    
    <li ><a href="#method-i-files_hashs">#files_hashs</a>
    
    <li ><a href="#method-i-gcc_cmd">#gcc_cmd</a>
    
    <li ><a href="#method-i-include_path">#include_path</a>
    
    <li ><a href="#method-i-install">#install</a>
    
    <li ><a href="#method-i-installed-3F">#installed?</a>
    
    <li ><a href="#method-i-lib_path">#lib_path</a>
    
    <li ><a href="#method-i-log_file">#log_file</a>
    
    <li ><a href="#method-i-make_cmd">#make_cmd</a>
    
    <li ><a href="#method-i-message">#message</a>
    
    <li ><a href="#method-i-minimal_pkg_config">#minimal_pkg_config</a>
    
    <li ><a href="#method-i-mkmf_config">#mkmf_config</a>
    
    <li ><a href="#method-i-native_path">#native_path</a>
    
    <li ><a href="#method-i-newer-3F">#newer?</a>
    
    <li ><a href="#method-i-output">#output</a>
    
    <li ><a href="#method-i-patch">#patch</a>
    
    <li ><a href="#method-i-path">#path</a>
    
    <li ><a href="#method-i-port_path">#port_path</a>
    
    <li ><a href="#method-i-posix_path">#posix_path</a>
    
    <li ><a href="#method-i-prepare_build_directory">#prepare_build_directory</a>
    
    <li ><a href="#method-i-source_directory-3D">#source_directory=</a>
    
    <li ><a href="#method-i-tar_command">#tar_command</a>
    
    <li ><a href="#method-i-tar_exe">#tar_exe</a>
    
    <li ><a href="#method-i-tmp_path">#tmp_path</a>
    
    <li ><a href="#method-i-verify_file">#verify_file</a>
    
    <li ><a href="#method-i-which">#which</a>
    
    <li ><a href="#method-i-with_tempfile">#with_tempfile</a>
    
    <li ><a href="#method-i-work_path">#work_path</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-MiniPortile">
  <h1 id="class-MiniPortile" class="class">
    class MiniPortile
  </h1>

  <section class="description">
    
  </section>

  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
      
        <dt id="DEFAULT_TIMEOUT">DEFAULT_TIMEOUT
        
        <dd>
        
      
        <dt id="KEYRING_NAME">KEYRING_NAME
        
        <dd>
        
      
        <dt id="TAR_EXECUTABLES">TAR_EXECUTABLES
        
        <dd>
        
      
        <dt id="VERSION">VERSION
        
        <dd>
        
      
      </dl>
    </section>
    

    
    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      
      <div id="attribute-i-configure_options" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">configure_options</span><span
            class="attribute-access-type">[W]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-files" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">files</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-host" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">host</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-logger" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">logger</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-name" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">name</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-original_host" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">original_host</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-patch_files" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">patch_files</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-source_directory" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">source_directory</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-target" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">target</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-version" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">version</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
    </section>
    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-darwin-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">darwin?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="darwin-3F-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 54</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">darwin?</span>
  <span class="ruby-identifier">target_os</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/darwin/</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-freebsd-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">freebsd?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="freebsd-3F-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 58</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">freebsd?</span>
  <span class="ruby-identifier">target_os</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/freebsd/</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-linux-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">linux?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="linux-3F-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 66</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">linux?</span>
  <span class="ruby-identifier">target_os</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/linux/</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-mingw-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">mingw?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>GNU MinGW compiled Ruby?</p>
          
          

          
          <div class="method-source-code" id="mingw-3F-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 45</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">mingw?</span>
  <span class="ruby-identifier">target_os</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/mingw/</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-mswin-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">mswin?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>MS Visual-C compiled Ruby?</p>
          
          

          
          <div class="method-source-code" id="mswin-3F-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 50</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">mswin?</span>
  <span class="ruby-identifier">target_os</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/mswin/</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-native_path" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">native_path</span><span
            class="method-args">(path)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="native_path-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 82</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">native_path</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-identifier">path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">ALT_SEPARATOR</span>
    <span class="ruby-identifier">path</span>.<span class="ruby-identifier">tr</span>(<span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">SEPARATOR</span>, <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">ALT_SEPARATOR</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">path</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(name, version, **kwargs)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 100</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span>, <span class="ruby-operator">**</span><span class="ruby-identifier">kwargs</span>)
  <span class="ruby-ivar">@name</span> = <span class="ruby-identifier">name</span>
  <span class="ruby-ivar">@version</span> = <span class="ruby-identifier">version</span>
  <span class="ruby-ivar">@target</span> = <span class="ruby-string">&#39;ports&#39;</span>
  <span class="ruby-ivar">@files</span> = []
  <span class="ruby-ivar">@patch_files</span> = []
  <span class="ruby-ivar">@log_files</span> = {}
  <span class="ruby-ivar">@logger</span> = <span class="ruby-identifier">kwargs</span>[<span class="ruby-value">:logger</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">STDOUT</span>
  <span class="ruby-ivar">@source_directory</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-ivar">@cc_command</span> = <span class="ruby-identifier">kwargs</span>[<span class="ruby-value">:cc_command</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">kwargs</span>[<span class="ruby-value">:gcc_command</span>]
  <span class="ruby-ivar">@cxx_command</span> = <span class="ruby-identifier">kwargs</span>[<span class="ruby-value">:cxx_command</span>]
  <span class="ruby-ivar">@make_command</span> = <span class="ruby-identifier">kwargs</span>[<span class="ruby-value">:make_command</span>]
  <span class="ruby-ivar">@open_timeout</span> = <span class="ruby-identifier">kwargs</span>[<span class="ruby-value">:open_timeout</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">DEFAULT_TIMEOUT</span>
  <span class="ruby-ivar">@read_timeout</span> = <span class="ruby-identifier">kwargs</span>[<span class="ruby-value">:read_timeout</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">DEFAULT_TIMEOUT</span>

  <span class="ruby-ivar">@original_host</span> = <span class="ruby-ivar">@host</span> = <span class="ruby-identifier">detect_host</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-openbsd-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">openbsd?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="openbsd-3F-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 62</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">openbsd?</span>
  <span class="ruby-identifier">target_os</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/openbsd/</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-posix_path" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">posix_path</span><span
            class="method-args">(path)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="posix_path-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 91</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">posix_path</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-identifier">path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">ALT_SEPARATOR</span>
    <span class="ruby-string">&quot;/&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">tr</span>(<span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">ALT_SEPARATOR</span>, <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">SEPARATOR</span>).<span class="ruby-identifier">tr</span>(<span class="ruby-string">&quot;:&quot;</span>, <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">SEPARATOR</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">path</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-solaris-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">solaris?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="solaris-3F-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 70</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">solaris?</span>
  <span class="ruby-identifier">target_os</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/solaris/</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-target_cpu" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">target_cpu</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="target_cpu-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 78</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">target_cpu</span>
  <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&#39;target_cpu&#39;</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-target_os" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">target_os</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="target_os-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 74</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">target_os</span>
  <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&#39;target_os&#39;</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-windows-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">windows?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="windows-3F-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 40</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">windows?</span>
  <span class="ruby-identifier">target_os</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/mswin|mingw/</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-activate" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">activate</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="activate-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 243</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">activate</span>
  <span class="ruby-identifier">vars</span> = {
    <span class="ruby-string">&#39;PATH&#39;</span>          <span class="ruby-operator">=&gt;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">port_path</span>, <span class="ruby-string">&#39;bin&#39;</span>),
    <span class="ruby-string">&#39;CPATH&#39;</span>         <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">include_path</span>,
    <span class="ruby-string">&#39;LIBRARY_PATH&#39;</span>  <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lib_path</span>,
  }.<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">env</span>, <span class="ruby-identifier">path</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">path</span>) }

  <span class="ruby-identifier">output</span> <span class="ruby-node">&quot;Activating #{@name} #{@version} (from #{port_path})...&quot;</span>
  <span class="ruby-identifier">vars</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">var</span>, <span class="ruby-identifier">path</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">full_path</span> = <span class="ruby-identifier">native_path</span>(<span class="ruby-identifier">path</span>)

    <span class="ruby-comment"># save current variable value</span>
    <span class="ruby-identifier">old_value</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-identifier">var</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&#39;&#39;</span>

    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">old_value</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">full_path</span>)
      <span class="ruby-constant">ENV</span>[<span class="ruby-identifier">var</span>] = <span class="ruby-node">&quot;#{full_path}#{File::PATH_SEPARATOR}#{old_value}&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># rely on LDFLAGS when cross-compiling</span>
  <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">lib_path</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-ivar">@host</span> <span class="ruby-operator">!=</span> <span class="ruby-ivar">@original_host</span>)
    <span class="ruby-identifier">full_path</span> = <span class="ruby-identifier">native_path</span>(<span class="ruby-identifier">lib_path</span>)

    <span class="ruby-identifier">old_value</span> = <span class="ruby-constant">ENV</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-string">&quot;LDFLAGS&quot;</span>, <span class="ruby-string">&quot;&quot;</span>)

    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">old_value</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">full_path</span>)
      <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;LDFLAGS&quot;</span>] = <span class="ruby-node">&quot;-L#{full_path} #{old_value}&quot;</span>.<span class="ruby-identifier">strip</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-apply_patch" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">apply_patch</span><span
            class="method-args">(patch_file)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="apply_patch-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 144</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">apply_patch</span>(<span class="ruby-identifier">patch_file</span>)
  (
    <span class="ruby-comment"># Not a class variable because closures will capture self.</span>
    <span class="ruby-ivar">@apply_patch</span> <span class="ruby-operator">||=</span>
    <span class="ruby-keyword">case</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">which</span>(<span class="ruby-string">&#39;git&#39;</span>)
      <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">message</span> <span class="ruby-node">&quot;Running git apply with #{file}... &quot;</span>
        <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">mktmpdir</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">tmp_git_dir</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">execute</span>(<span class="ruby-string">&#39;patch&#39;</span>, [<span class="ruby-string">&quot;git&quot;</span>, <span class="ruby-node">&quot;--git-dir=#{tmp_git_dir}&quot;</span>, <span class="ruby-string">&quot;--work-tree=.&quot;</span>, <span class="ruby-string">&quot;apply&quot;</span>, <span class="ruby-string">&quot;--whitespace=warn&quot;</span>, <span class="ruby-identifier">file</span>], <span class="ruby-value">:initial_message</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">false</span>)
        <span class="ruby-keyword">end</span>
      }
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">which</span>(<span class="ruby-string">&#39;patch&#39;</span>)
      <span class="ruby-identifier">lambda</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">message</span> <span class="ruby-node">&quot;Running patch with #{file}... &quot;</span>
        <span class="ruby-identifier">execute</span>(<span class="ruby-string">&#39;patch&#39;</span>, [<span class="ruby-string">&quot;patch&quot;</span>, <span class="ruby-string">&quot;-p1&quot;</span>, <span class="ruby-string">&quot;-i&quot;</span>, <span class="ruby-identifier">file</span>], <span class="ruby-value">:initial_message</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">false</span>)
      }
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;Failed to complete patch task; patch(1) or git(1) is required.&quot;</span>
    <span class="ruby-keyword">end</span>
  ).<span class="ruby-identifier">call</span>(<span class="ruby-identifier">patch_file</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-cc_cmd" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">cc_cmd</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="cc_cmd-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 375</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">cc_cmd</span>
  (<span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;CC&quot;</span>] <span class="ruby-operator">||</span> <span class="ruby-ivar">@cc_command</span> <span class="ruby-operator">||</span> <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&quot;CC&quot;</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&quot;gcc&quot;</span>).<span class="ruby-identifier">dup</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="MiniPortile.html#method-i-gcc_cmd">gcc_cmd</a>
        </div>
        

        
      </div>

    
      <div id="method-i-compile" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">compile</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="compile-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 193</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">compile</span>
  <span class="ruby-identifier">execute</span>(<span class="ruby-string">&#39;compile&#39;</span>, <span class="ruby-identifier">make_cmd</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-configure" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">configure</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="configure-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 178</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">configure</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">configured?</span>

  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>(<span class="ruby-identifier">tmp_path</span>)
  <span class="ruby-identifier">cache_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">tmp_path</span>, <span class="ruby-string">&#39;configure.options_cache&#39;</span>)
  <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">cache_file</span>, <span class="ruby-string">&quot;w&quot;</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">computed_options</span>.<span class="ruby-identifier">to_s</span> }

  <span class="ruby-identifier">command</span> = <span class="ruby-constant">Array</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>((<span class="ruby-identifier">source_directory</span> <span class="ruby-operator">||</span> <span class="ruby-string">&quot;.&quot;</span>), <span class="ruby-string">&quot;configure&quot;</span>))
  <span class="ruby-keyword">if</span> <span class="ruby-constant">RUBY_PLATFORM</span><span class="ruby-operator">=~</span><span class="ruby-regexp">/mingw|mswin/</span>
    <span class="ruby-comment"># Windows doesn&#39;t recognize the shebang.</span>
    <span class="ruby-identifier">command</span>.<span class="ruby-identifier">unshift</span>(<span class="ruby-string">&quot;sh&quot;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">execute</span>(<span class="ruby-string">&#39;configure&#39;</span>, <span class="ruby-identifier">command</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">computed_options</span>, <span class="ruby-value">altlog:</span> <span class="ruby-string">&quot;config.log&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-configure_options" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">configure_options</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="configure_options-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 174</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">configure_options</span>
  <span class="ruby-ivar">@configure_options</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">configure_defaults</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-configured-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">configured?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="configured-3F-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 210</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">configured?</span>
  <span class="ruby-identifier">configure</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>((<span class="ruby-identifier">source_directory</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">work_path</span>), <span class="ruby-string">&#39;configure&#39;</span>)
  <span class="ruby-identifier">makefile</span>  = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">work_path</span>, <span class="ruby-string">&#39;Makefile&#39;</span>)
  <span class="ruby-identifier">cache_file</span>  = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">tmp_path</span>, <span class="ruby-string">&#39;configure.options_cache&#39;</span>)

  <span class="ruby-identifier">stored_options</span>  = <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">cache_file</span>) <span class="ruby-operator">?</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">cache_file</span>) <span class="ruby-operator">:</span> <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-identifier">current_options</span> = <span class="ruby-identifier">computed_options</span>.<span class="ruby-identifier">to_s</span>

  (<span class="ruby-identifier">current_options</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">stored_options</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">newer?</span>(<span class="ruby-identifier">makefile</span>, <span class="ruby-identifier">configure</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-cook" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">cook</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="cook-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 228</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">cook</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">source_directory</span>
    <span class="ruby-identifier">prepare_build_directory</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">download</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">downloaded?</span>
    <span class="ruby-identifier">extract</span>
    <span class="ruby-identifier">patch</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">configure</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">configured?</span>
  <span class="ruby-identifier">compile</span>
  <span class="ruby-identifier">install</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">installed?</span>

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-cxx_cmd" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">cxx_cmd</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="cxx_cmd-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 380</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">cxx_cmd</span>
  (<span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;CXX&quot;</span>] <span class="ruby-operator">||</span> <span class="ruby-ivar">@cxx_command</span> <span class="ruby-operator">||</span> <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&quot;CXX&quot;</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&quot;g++&quot;</span>).<span class="ruby-identifier">dup</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-download" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">download</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="download-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 130</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">download</span>
  <span class="ruby-identifier">files_hashs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">download_file</span>(<span class="ruby-identifier">file</span>[<span class="ruby-value">:url</span>], <span class="ruby-identifier">file</span>[<span class="ruby-value">:local_path</span>])
    <span class="ruby-identifier">verify_file</span>(<span class="ruby-identifier">file</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-downloaded-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">downloaded?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="downloaded-3F-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 202</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">downloaded?</span>
  <span class="ruby-identifier">missing</span> = <span class="ruby-identifier">files_hashs</span>.<span class="ruby-identifier">detect</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
    <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">file</span>[<span class="ruby-value">:local_path</span>])
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">missing</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">false</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-extract" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">extract</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="extract-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 137</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">extract</span>
  <span class="ruby-identifier">files_hashs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">verify_file</span>(<span class="ruby-identifier">file</span>)
    <span class="ruby-identifier">extract_file</span>(<span class="ruby-identifier">file</span>[<span class="ruby-value">:local_path</span>], <span class="ruby-identifier">tmp_path</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-gcc_cmd" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">gcc_cmd</span><span
            class="method-args">()</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="MiniPortile.html#method-i-cc_cmd">cc_cmd</a>
        </div>
        
      </div>

    
      <div id="method-i-include_path" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">include_path</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="include_path-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 367</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">include_path</span>
  <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">path</span>, <span class="ruby-string">&quot;include&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-install" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">install</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="install-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 197</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">install</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">installed?</span>
  <span class="ruby-identifier">execute</span>(<span class="ruby-string">&#39;install&#39;</span>, <span class="ruby-node">%Q(#{make_cmd} install)</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-installed-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">installed?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="installed-3F-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 221</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">installed?</span>
  <span class="ruby-identifier">makefile</span>  = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">work_path</span>, <span class="ruby-string">&#39;Makefile&#39;</span>)
  <span class="ruby-identifier">target_dir</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-node">&quot;#{port_path}/*&quot;</span>).<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">d</span>) }

  <span class="ruby-identifier">newer?</span>(<span class="ruby-identifier">target_dir</span>, <span class="ruby-identifier">makefile</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-lib_path" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">lib_path</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="lib_path-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 371</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">lib_path</span>
  <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">path</span>, <span class="ruby-string">&quot;lib&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-make_cmd" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">make_cmd</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="make_cmd-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 384</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">make_cmd</span>
  (<span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;MAKE&quot;</span>] <span class="ruby-operator">||</span> <span class="ruby-ivar">@make_command</span> <span class="ruby-operator">||</span> <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;make&quot;</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&quot;make&quot;</span>).<span class="ruby-identifier">dup</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-mkmf_config" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">mkmf_config</span><span
            class="method-args">(pkg: nil, dir: nil, static: nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>pkg: the pkg-config file name (without the .pc extension) dir: inject the directory path for the pkg-config file (probably only useful for tests) static: the name of the static library archive (without the lib prefix or the file extension), or nil for dynamic linking</p>

<p>we might be able to be terribly clever and infer the name of the static archive file, but unfortunately projects have so much freedom in what they can report (for name, for libs, etc.) that it feels unreliable to try to do so, so I&#39;m preferring to just have the developer make it explicit.</p>
          
          

          
          <div class="method-source-code" id="mkmf_config-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 282</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">mkmf_config</span>(<span class="ruby-value">pkg:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">dir:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">static:</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">require</span> <span class="ruby-string">&quot;mkmf&quot;</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">pkg</span>
    <span class="ruby-identifier">dir</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">lib_path</span>, <span class="ruby-string">&quot;pkgconfig&quot;</span>)
    <span class="ruby-identifier">pcfile</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">dir</span>, <span class="ruby-node">&quot;#{pkg}.pc&quot;</span>)
    <span class="ruby-keyword">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">pcfile</span>)
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;pkg-config file &#39;#{pcfile}&#39; does not exist&quot;</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">output</span> <span class="ruby-node">&quot;Configuring MakeMakefile for #{File.basename(pcfile)} (in #{File.dirname(pcfile)})\n&quot;</span>

    <span class="ruby-comment"># on macos, pkg-config will not return --cflags without this</span>
    <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;PKG_CONFIG_ALLOW_SYSTEM_CFLAGS&quot;</span>] = <span class="ruby-string">&quot;t&quot;</span>

    <span class="ruby-comment"># append to PKG_CONFIG_PATH as we go, so later pkg-config files can depend on earlier ones</span>
    <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;PKG_CONFIG_PATH&quot;</span>] = [<span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;PKG_CONFIG_PATH&quot;</span>], <span class="ruby-identifier">dir</span>].<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">PATH_SEPARATOR</span>)

    <span class="ruby-identifier">incflags</span> = <span class="ruby-identifier">minimal_pkg_config</span>(<span class="ruby-identifier">pcfile</span>, <span class="ruby-string">&quot;cflags-only-I&quot;</span>)
    <span class="ruby-identifier">cflags</span> = <span class="ruby-identifier">minimal_pkg_config</span>(<span class="ruby-identifier">pcfile</span>, <span class="ruby-string">&quot;cflags-only-other&quot;</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">static</span>
      <span class="ruby-identifier">ldflags</span> = <span class="ruby-identifier">minimal_pkg_config</span>(<span class="ruby-identifier">pcfile</span>, <span class="ruby-string">&quot;libs-only-L&quot;</span>, <span class="ruby-string">&quot;static&quot;</span>)
      <span class="ruby-identifier">libflags</span> = <span class="ruby-identifier">minimal_pkg_config</span>(<span class="ruby-identifier">pcfile</span>, <span class="ruby-string">&quot;libs-only-l&quot;</span>, <span class="ruby-string">&quot;static&quot;</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">ldflags</span> = <span class="ruby-identifier">minimal_pkg_config</span>(<span class="ruby-identifier">pcfile</span>, <span class="ruby-string">&quot;libs-only-L&quot;</span>)
      <span class="ruby-identifier">libflags</span> = <span class="ruby-identifier">minimal_pkg_config</span>(<span class="ruby-identifier">pcfile</span>, <span class="ruby-string">&quot;libs-only-l&quot;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">output</span> <span class="ruby-node">&quot;Configuring MakeMakefile for #{@name} #{@version} (from #{path})\n&quot;</span>

    <span class="ruby-identifier">lib_name</span> = <span class="ruby-identifier">name</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp">/\Alib/</span>, <span class="ruby-string">&quot;&quot;</span>) <span class="ruby-comment"># TODO: use delete_prefix when we no longer support ruby 2.4</span>

    <span class="ruby-identifier">incflags</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">include_path</span>) <span class="ruby-operator">?</span> <span class="ruby-node">&quot;-I#{include_path}&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">cflags</span> = <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">ldflags</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">lib_path</span>) <span class="ruby-operator">?</span> <span class="ruby-node">&quot;-L#{lib_path}&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot;&quot;</span>
    <span class="ruby-identifier">libflags</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">lib_path</span>) <span class="ruby-operator">?</span> <span class="ruby-node">&quot;-l#{lib_name}&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">static</span>
    <span class="ruby-identifier">libdir</span> = <span class="ruby-identifier">lib_path</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">pcfile</span>
      <span class="ruby-identifier">pcfile_libdir</span> = <span class="ruby-identifier">minimal_pkg_config</span>(<span class="ruby-identifier">pcfile</span>, <span class="ruby-string">&quot;variable=libdir&quot;</span>).<span class="ruby-identifier">strip</span>
      <span class="ruby-identifier">libdir</span> = <span class="ruby-identifier">pcfile_libdir</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">pcfile_libdir</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment">#</span>
    <span class="ruby-comment"># keep track of the libraries we&#39;re statically linking against, and fix up ldflags and</span>
    <span class="ruby-comment"># libflags to make sure we link statically against the recipe&#39;s libaries.</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-comment"># this avoids the unintentionally dynamically linking against system libraries, and makes sure</span>
    <span class="ruby-comment"># that if multiple pkg-config files reference each other that we are able to intercept flags</span>
    <span class="ruby-comment"># from dependent packages that reference the static archive.</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-identifier">$MINI_PORTILE_STATIC_LIBS</span>[<span class="ruby-identifier">static</span>] = <span class="ruby-identifier">libdir</span>
    <span class="ruby-identifier">static_ldflags</span> = <span class="ruby-identifier">$MINI_PORTILE_STATIC_LIBS</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;-L#{v}&quot;</span> }
    <span class="ruby-identifier">static_libflags</span> = <span class="ruby-identifier">$MINI_PORTILE_STATIC_LIBS</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;-l#{v}&quot;</span> }

    <span class="ruby-comment"># remove `-L#{libdir}` and `-lfoo`. we don&#39;t need them since we link against the static</span>
    <span class="ruby-comment"># archive using the full path.</span>
    <span class="ruby-identifier">ldflags</span> = <span class="ruby-identifier">ldflags</span>.<span class="ruby-identifier">shellsplit</span>.<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">static_ldflags</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">f</span>) }.<span class="ruby-identifier">shelljoin</span>
    <span class="ruby-identifier">libflags</span> = <span class="ruby-identifier">libflags</span>.<span class="ruby-identifier">shellsplit</span>.<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">static_libflags</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">f</span>) }.<span class="ruby-identifier">shelljoin</span>

    <span class="ruby-comment"># prepend the full path to the static archive to the linker flags</span>
    <span class="ruby-identifier">static_archive</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">libdir</span>, <span class="ruby-node">&quot;lib#{static}.#{$LIBEXT}&quot;</span>)
    <span class="ruby-identifier">libflags</span> = [<span class="ruby-identifier">static_archive</span>, <span class="ruby-identifier">libflags</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot; &quot;</span>).<span class="ruby-identifier">strip</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># prefer this package by prepending to search paths and library flags</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># convert the ldflags into a list of directories and append to $LIBPATH (instead of just using</span>
  <span class="ruby-comment"># $LDFLAGS) to ensure we get the `-Wl,-rpath` linker flag for re-finding shared libraries.</span>
  <span class="ruby-identifier">$INCFLAGS</span> = [<span class="ruby-identifier">incflags</span>, <span class="ruby-identifier">$INCFLAGS</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot; &quot;</span>).<span class="ruby-identifier">strip</span>
  <span class="ruby-identifier">libpaths</span> = <span class="ruby-identifier">ldflags</span>.<span class="ruby-identifier">shellsplit</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp">/\A-L/</span>, <span class="ruby-string">&quot;&quot;</span>) }
  <span class="ruby-identifier">$LIBPATH</span> = <span class="ruby-identifier">libpaths</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">$LIBPATH</span>
  <span class="ruby-identifier">$libs</span> = [<span class="ruby-identifier">libflags</span>, <span class="ruby-identifier">$libs</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot; &quot;</span>).<span class="ruby-identifier">strip</span>

  <span class="ruby-comment"># prefer this package&#39;s compiler flags by appending them to the command line</span>
  <span class="ruby-identifier">$CFLAGS</span> = [<span class="ruby-identifier">$CFLAGS</span>, <span class="ruby-identifier">cflags</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot; &quot;</span>).<span class="ruby-identifier">strip</span>
  <span class="ruby-identifier">$CXXFLAGS</span> = [<span class="ruby-identifier">$CXXFLAGS</span>, <span class="ruby-identifier">cflags</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot; &quot;</span>).<span class="ruby-identifier">strip</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-patch" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">patch</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="patch-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 167</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">patch</span>
  <span class="ruby-ivar">@patch_files</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">full_path</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">full_path</span>)
    <span class="ruby-identifier">apply_patch</span>(<span class="ruby-identifier">full_path</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-path" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">path</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="path-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 363</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">path</span>
  <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">port_path</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-prepare_build_directory" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">prepare_build_directory</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="prepare_build_directory-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 123</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">prepare_build_directory</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;source_directory is not set&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">source_directory</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">output</span> <span class="ruby-node">&quot;Building #{@name} from source at &#39;#{source_directory}&#39;&quot;</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">tmp_path</span>, [<span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;-&quot;</span>)))
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span>(<span class="ruby-identifier">port_path</span>) <span class="ruby-comment"># make sure we always re-install</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-source_directory-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">source_directory=</span><span
            class="method-args">(path)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="source_directory-3D-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 119</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">source_directory=</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-ivar">@source_directory</span> = <span class="ruby-identifier">posix_path</span>(<span class="ruby-identifier">path</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="private-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Private Instance Methods</h3>
       </header>

    
      <div id="method-i-archives_path" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">archives_path</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="archives_path-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 406</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">archives_path</span>
  <span class="ruby-node">&quot;#{@target}/archives&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-computed_options" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">computed_options</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="computed_options-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 426</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">computed_options</span>
  [
    <span class="ruby-identifier">configure_options</span>,     <span class="ruby-comment"># customized or default options</span>
    <span class="ruby-identifier">configure_prefix</span>,      <span class="ruby-comment"># installation target</span>
  ].<span class="ruby-identifier">flatten</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-configure_defaults" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">configure_defaults</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="configure_defaults-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 414</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">configure_defaults</span>
  [
    <span class="ruby-node">&quot;--host=#{@host}&quot;</span>,    <span class="ruby-comment"># build for specific target (host)</span>
    <span class="ruby-string">&quot;--enable-static&quot;</span>,    <span class="ruby-comment"># build static library</span>
    <span class="ruby-string">&quot;--disable-shared&quot;</span>    <span class="ruby-comment"># disable generation of shared object</span>
  ]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-configure_prefix" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">configure_prefix</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="configure_prefix-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 422</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">configure_prefix</span>
  <span class="ruby-node">&quot;--prefix=#{File.expand_path(port_path)}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-detect_host" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">detect_host</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="detect_host-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 528</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">detect_host</span>
  <span class="ruby-keyword">return</span> <span class="ruby-ivar">@detect_host</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-ivar">@detect_host</span>)

  <span class="ruby-keyword">begin</span>
    <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;LC_ALL&quot;</span>], <span class="ruby-identifier">old_lc_all</span> = <span class="ruby-string">&quot;C&quot;</span>, <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;LC_ALL&quot;</span>]

    <span class="ruby-identifier">output</span> = <span class="ruby-node">`#{gcc_cmd} -v 2&gt;&amp;1`</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">m</span> = <span class="ruby-identifier">output</span>.<span class="ruby-identifier">match</span>(<span class="ruby-regexp">/^Target\: (.*)$/</span>)
      <span class="ruby-ivar">@detect_host</span> = <span class="ruby-identifier">m</span>[<span class="ruby-value">1</span>]
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@detect_host</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-ivar">@detect_host</span>
  <span class="ruby-keyword">ensure</span>
    <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;LC_ALL&quot;</span>] = <span class="ruby-identifier">old_lc_all</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-download_file" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">download_file</span><span
            class="method-args">(url, full_path, count = 3)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Slighly modified from RubyInstaller uri_ext, Rubinius configure and adaptations of Wayne&#39;s RailsInstaller</p>
          
          

          
          <div class="method-source-code" id="download_file-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 650</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">download_file</span>(<span class="ruby-identifier">url</span>, <span class="ruby-identifier">full_path</span>, <span class="ruby-identifier">count</span> = <span class="ruby-value">3</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">full_path</span>)
  <span class="ruby-identifier">uri</span> = <span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">url</span>)

  <span class="ruby-keyword">case</span> <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">scheme</span>.<span class="ruby-identifier">downcase</span>
  <span class="ruby-keyword">when</span> <span class="ruby-regexp">/ftp/</span>
    <span class="ruby-identifier">download_file_ftp</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">full_path</span>)
  <span class="ruby-keyword">when</span> <span class="ruby-regexp">/http|https/</span>
    <span class="ruby-identifier">download_file_http</span>(<span class="ruby-identifier">url</span>, <span class="ruby-identifier">full_path</span>, <span class="ruby-identifier">count</span>)
  <span class="ruby-keyword">when</span> <span class="ruby-regexp">/file/</span>
    <span class="ruby-identifier">download_file_file</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">full_path</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;Unsupported protocol for #{url}&quot;</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">e</span>
  <span class="ruby-constant">File</span>.<span class="ruby-identifier">unlink</span> <span class="ruby-identifier">full_path</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">full_path</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-identifier">e</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-download_file_file" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">download_file_file</span><span
            class="method-args">(uri, full_path)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="download_file_file-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 723</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">download_file_file</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">full_path</span>)
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">full_path</span>)
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">cp</span> <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">path</span>, <span class="ruby-identifier">full_path</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-download_file_ftp" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">download_file_ftp</span><span
            class="method-args">(uri, full_path)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="download_file_ftp-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 728</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">download_file_ftp</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">full_path</span>)
  <span class="ruby-identifier">require</span> <span class="ruby-string">&quot;net/ftp&quot;</span>
  <span class="ruby-identifier">filename</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">uri</span>.<span class="ruby-identifier">path</span>)
  <span class="ruby-identifier">with_tempfile</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">full_path</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">temp_file</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">total</span> = <span class="ruby-value">0</span>
    <span class="ruby-identifier">params</span> = {
      <span class="ruby-value">:content_length_proc</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">length</span><span class="ruby-operator">|</span> <span class="ruby-identifier">total</span> = <span class="ruby-identifier">length</span> },
      <span class="ruby-value">:progress_proc</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">bytes</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">new_progress</span> = (<span class="ruby-identifier">bytes</span> <span class="ruby-operator">*</span> <span class="ruby-value">100</span>) <span class="ruby-operator">/</span> <span class="ruby-identifier">total</span>
        <span class="ruby-identifier">message</span> <span class="ruby-string">&quot;\rDownloading %s (%3d%%) &quot;</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">new_progress</span>]
      },
      <span class="ruby-value">:open_timeout</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-ivar">@open_timeout</span>,
      <span class="ruby-value">:read_timeout</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-ivar">@read_timeout</span>,
    }
    <span class="ruby-keyword">if</span> <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;ftp_proxy&quot;</span>]
      <span class="ruby-identifier">_</span>, <span class="ruby-identifier">userinfo</span>, <span class="ruby-identifier">_p_host</span>, <span class="ruby-identifier">_p_port</span> = <span class="ruby-constant">URI</span>.<span class="ruby-identifier">split</span>(<span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;ftp_proxy&#39;</span>])
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">userinfo</span>
        <span class="ruby-identifier">proxy_user</span>, <span class="ruby-identifier">proxy_pass</span> = <span class="ruby-identifier">userinfo</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/:/</span>).<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-constant">CGI</span>.<span class="ruby-identifier">unescape</span>(<span class="ruby-identifier">s</span>) }
        <span class="ruby-identifier">params</span>[<span class="ruby-value">:proxy_http_basic_authentication</span>] =
          [<span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;ftp_proxy&#39;</span>], <span class="ruby-identifier">proxy_user</span>, <span class="ruby-identifier">proxy_pass</span>]
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-constant">OpenURI</span>.<span class="ruby-identifier">open_uri</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-string">&#39;rb&#39;</span>, <span class="ruby-identifier">params</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">temp_file</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">io</span>.<span class="ruby-identifier">read</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">output</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">rescue</span> <span class="ruby-constant">LoadError</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">LoadError</span>, <span class="ruby-node">&quot;Ruby #{RUBY_VERSION} does not provide the net-ftp gem, please add it as a dependency if you need to use FTP&quot;</span>
<span class="ruby-keyword">rescue</span> <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">FTPError</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-download_file_http" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">download_file_http</span><span
            class="method-args">(url, full_path, count = 3)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="download_file_http-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 669</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">download_file_http</span>(<span class="ruby-identifier">url</span>, <span class="ruby-identifier">full_path</span>, <span class="ruby-identifier">count</span> = <span class="ruby-value">3</span>)
  <span class="ruby-identifier">filename</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">full_path</span>)
  <span class="ruby-identifier">with_tempfile</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">full_path</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">temp_file</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">total</span> = <span class="ruby-value">0</span>
    <span class="ruby-identifier">params</span> = {
      <span class="ruby-string">&quot;Accept-Encoding&quot;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;identity&#39;</span>,
      <span class="ruby-value">:content_length_proc</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">length</span><span class="ruby-operator">|</span> <span class="ruby-identifier">total</span> = <span class="ruby-identifier">length</span> },
      <span class="ruby-value">:progress_proc</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">lambda</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">bytes</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">total</span>
          <span class="ruby-identifier">new_progress</span> = (<span class="ruby-identifier">bytes</span> <span class="ruby-operator">*</span> <span class="ruby-value">100</span>) <span class="ruby-operator">/</span> <span class="ruby-identifier">total</span>
          <span class="ruby-identifier">message</span> <span class="ruby-string">&quot;\rDownloading %s (%3d%%) &quot;</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">new_progress</span>]
        <span class="ruby-keyword">else</span>
          <span class="ruby-comment"># Content-Length is unavailable because Transfer-Encoding is chunked</span>
          <span class="ruby-identifier">message</span> <span class="ruby-string">&quot;\rDownloading %s &quot;</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">filename</span>]
        <span class="ruby-keyword">end</span>
      },
      <span class="ruby-value">:open_timeout</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-ivar">@open_timeout</span>,
      <span class="ruby-value">:read_timeout</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-ivar">@read_timeout</span>,
    }
    <span class="ruby-identifier">proxy_uri</span> = <span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">url</span>).<span class="ruby-identifier">scheme</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;https&#39;</span> <span class="ruby-operator">?</span>
                <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;https_proxy&quot;</span>] <span class="ruby-operator">:</span>
                <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;http_proxy&quot;</span>]
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">proxy_uri</span>
      <span class="ruby-identifier">_</span>, <span class="ruby-identifier">userinfo</span>, <span class="ruby-identifier">_p_host</span>, <span class="ruby-identifier">_p_port</span> = <span class="ruby-constant">URI</span>.<span class="ruby-identifier">split</span>(<span class="ruby-identifier">proxy_uri</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">userinfo</span>
        <span class="ruby-identifier">proxy_user</span>, <span class="ruby-identifier">proxy_pass</span> = <span class="ruby-identifier">userinfo</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/:/</span>).<span class="ruby-identifier">map</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-constant">CGI</span>.<span class="ruby-identifier">unescape</span>(<span class="ruby-identifier">s</span>) }
        <span class="ruby-identifier">params</span>[<span class="ruby-value">:proxy_http_basic_authentication</span>] =
          [<span class="ruby-identifier">proxy_uri</span>, <span class="ruby-identifier">proxy_user</span>, <span class="ruby-identifier">proxy_pass</span>]
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">begin</span>
      <span class="ruby-constant">OpenURI</span>.<span class="ruby-identifier">open_uri</span>(<span class="ruby-identifier">url</span>, <span class="ruby-string">&#39;rb&#39;</span>, <span class="ruby-identifier">params</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">temp_file</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">io</span>.<span class="ruby-identifier">read</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">output</span>
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">OpenURI</span><span class="ruby-operator">::</span><span class="ruby-constant">HTTPRedirect</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">redirect</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;Too many redirections for the original URL, halting.&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">count</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span>
      <span class="ruby-identifier">count</span> = <span class="ruby-identifier">count</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">download_file</span>(<span class="ruby-identifier">redirect</span>.<span class="ruby-identifier">url</span>, <span class="ruby-identifier">full_path</span>, <span class="ruby-identifier">count</span><span class="ruby-value">-1</span>)
    <span class="ruby-keyword">rescue</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">e</span>
      <span class="ruby-identifier">count</span> = <span class="ruby-identifier">count</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
      <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{count} retrie(s) left for #{filename} (#{e.message})&quot;</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
        <span class="ruby-identifier">sleep</span> <span class="ruby-value">1</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">download_file_http</span>(<span class="ruby-identifier">url</span>, <span class="ruby-identifier">full_path</span>, <span class="ruby-identifier">count</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">output</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">message</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-execute" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">execute</span><span
            class="method-args">(action, command, command_opts={})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>command could be an array of args, or one string containing a command passed to the shell. See Process.spawn for more information.</p>
          
          

          
          <div class="method-source-code" id="execute-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 580</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">execute</span>(<span class="ruby-identifier">action</span>, <span class="ruby-identifier">command</span>, <span class="ruby-identifier">command_opts</span>={})
  <span class="ruby-identifier">opt_message</span> = <span class="ruby-identifier">command_opts</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:initial_message</span>, <span class="ruby-keyword">true</span>)
  <span class="ruby-identifier">opt_debug</span> =   <span class="ruby-identifier">command_opts</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:debug</span>, <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">opt_cd</span> =      <span class="ruby-identifier">command_opts</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:cd</span>) { <span class="ruby-identifier">work_path</span> }
  <span class="ruby-identifier">opt_env</span> =     <span class="ruby-identifier">command_opts</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:env</span>) { <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> }
  <span class="ruby-identifier">opt_altlog</span> =  <span class="ruby-identifier">command_opts</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:altlog</span>, <span class="ruby-keyword">nil</span>)

  <span class="ruby-identifier">log_out</span> = <span class="ruby-identifier">log_file</span>(<span class="ruby-identifier">action</span>)

  <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span>(<span class="ruby-identifier">opt_cd</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">output</span> <span class="ruby-node">&quot;DEBUG: env is #{opt_env.inspect}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt_debug</span>
    <span class="ruby-identifier">output</span> <span class="ruby-node">&quot;DEBUG: command is #{command.inspect}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt_debug</span>
    <span class="ruby-identifier">message</span> <span class="ruby-node">&quot;Running &#39;#{action}&#39; for #{@name} #{@version}... &quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt_message</span>

    <span class="ruby-keyword">if</span> <span class="ruby-constant">Process</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:spawn</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span> <span class="ruby-constant">RbConfig</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:java</span>)
      <span class="ruby-identifier">options</span> = {[<span class="ruby-value">:out</span>, <span class="ruby-value">:err</span>]<span class="ruby-operator">=&gt;</span>[<span class="ruby-identifier">log_out</span>, <span class="ruby-string">&quot;a&quot;</span>]}
      <span class="ruby-identifier">output</span> <span class="ruby-node">&quot;DEBUG: options are #{options.inspect}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt_debug</span>
      <span class="ruby-identifier">args</span> = [<span class="ruby-identifier">opt_env</span>, <span class="ruby-identifier">command</span>, <span class="ruby-identifier">options</span>].<span class="ruby-identifier">flatten</span>
      <span class="ruby-identifier">pid</span> = <span class="ruby-identifier">spawn</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
      <span class="ruby-constant">Process</span>.<span class="ruby-identifier">wait</span>(<span class="ruby-identifier">pid</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">env_args</span> = <span class="ruby-identifier">opt_env</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;#{k}=#{v}&quot;</span>.<span class="ruby-identifier">shellescape</span> }.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot; &quot;</span>)
      <span class="ruby-identifier">c</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">command</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Array</span>)
            <span class="ruby-identifier">command</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:shellescape</span>).<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot; &quot;</span>)
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">command</span>
          <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">redirected</span> = <span class="ruby-node">%Q{env #{env_args} #{c} &gt; #{log_out.shellescape} 2&gt;&amp;1}</span>
      <span class="ruby-identifier">output</span> <span class="ruby-node">&quot;DEBUG: final command is #{redirected.inspect}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt_debug</span>
      <span class="ruby-identifier">system</span> <span class="ruby-identifier">redirected</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">$?</span>.<span class="ruby-identifier">success?</span>
      <span class="ruby-identifier">output</span> <span class="ruby-string">&quot;OK&quot;</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">output</span> <span class="ruby-string">&quot;ERROR. Please review logs to see what happened:\n&quot;</span>
      [<span class="ruby-identifier">log_out</span>, <span class="ruby-identifier">opt_altlog</span>].<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">log</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">log</span>)
        <span class="ruby-identifier">output</span>(<span class="ruby-node">&quot;----- contents of &#39;#{log}&#39; -----&quot;</span>)
        <span class="ruby-identifier">output</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">log</span>))
        <span class="ruby-identifier">output</span>(<span class="ruby-string">&quot;----- end of file -----&quot;</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Failed to complete #{action} task&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-extract_file" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">extract_file</span><span
            class="method-args">(file, target)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="extract_file-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 570</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">extract_file</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">target</span>)
  <span class="ruby-identifier">filename</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">file</span>)
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-identifier">target</span>

  <span class="ruby-identifier">message</span> <span class="ruby-node">&quot;Extracting #{filename} into #{target}... &quot;</span>
  <span class="ruby-identifier">execute</span>(<span class="ruby-string">&#39;extract&#39;</span>, <span class="ruby-identifier">tar_command</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">target</span>) , {<span class="ruby-value">:cd</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">pwd</span>, <span class="ruby-value">:initial_message</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">false</span>})
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-files_hashs" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">files_hashs</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="files_hashs-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 433</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">files_hashs</span>
  <span class="ruby-ivar">@files</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">hash</span> = <span class="ruby-keyword">case</span> <span class="ruby-identifier">file</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">String</span>
      { <span class="ruby-value">:url</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">file</span> }
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Hash</span>
      <span class="ruby-identifier">file</span>.<span class="ruby-identifier">dup</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-string">&quot;files must be an Array of Stings or Hashs&quot;</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">url</span> = <span class="ruby-identifier">hash</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:url</span>){ <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-string">&quot;no url given&quot;</span> }
    <span class="ruby-identifier">filename</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">url</span>)
    <span class="ruby-identifier">hash</span>[<span class="ruby-value">:local_path</span>] = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">archives_path</span>, <span class="ruby-identifier">filename</span>)
    <span class="ruby-identifier">hash</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-log_file" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">log_file</span><span
            class="method-args">(action)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="log_file-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 504</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">log_file</span>(<span class="ruby-identifier">action</span>)
  <span class="ruby-ivar">@log_files</span>[<span class="ruby-identifier">action</span>] <span class="ruby-operator">||=</span>
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-node">&quot;#{action}.log&quot;</span>, <span class="ruby-identifier">tmp_path</span>).<span class="ruby-identifier">tap</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
      <span class="ruby-constant">File</span>.<span class="ruby-identifier">unlink</span>(<span class="ruby-identifier">file</span>) <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">file</span>)
    }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-message" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">message</span><span
            class="method-args">(text)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>print out a message with the logger</p>
          
          

          
          <div class="method-source-code" id="message-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 637</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">message</span>(<span class="ruby-identifier">text</span>)
  <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">print</span> <span class="ruby-identifier">text</span>
  <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">flush</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-minimal_pkg_config" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">minimal_pkg_config</span><span
            class="method-args">(pkg, *pcoptions)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>this minimal version of pkg_config is based on ruby 29dc9378 (2023-01-09)</p>

<p>specifically with the fix from b90e56e6 to support multiple pkg-config options, and removing code paths that aren&#39;t helpful for mini-portile&#39;s use case of parsing pc files.</p>
          
          

          
          <div class="method-source-code" id="minimal_pkg_config-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 777</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">minimal_pkg_config</span>(<span class="ruby-identifier">pkg</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">pcoptions</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">pcoptions</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-string">&quot;no pkg-config options are given&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> (<span class="ruby-identifier">$PKGCONFIG</span> <span class="ruby-operator">||=</span>
      (<span class="ruby-identifier">pkgconfig</span> = <span class="ruby-constant">MakeMakefile</span>.<span class="ruby-identifier">with_config</span>(<span class="ruby-string">&quot;pkg-config&quot;</span>) {<span class="ruby-constant">MakeMakefile</span>.<span class="ruby-identifier">config_string</span>(<span class="ruby-string">&quot;PKG_CONFIG&quot;</span>) <span class="ruby-operator">||</span> <span class="ruby-string">&quot;pkg-config&quot;</span>}) <span class="ruby-operator">&amp;&amp;</span>
      <span class="ruby-constant">MakeMakefile</span>.<span class="ruby-identifier">find_executable0</span>(<span class="ruby-identifier">pkgconfig</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">pkgconfig</span>)
    <span class="ruby-identifier">pkgconfig</span> = <span class="ruby-identifier">$PKGCONFIG</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">RuntimeError</span>, <span class="ruby-string">&quot;pkg-config is not found&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">pcoptions</span> = <span class="ruby-constant">Array</span>(<span class="ruby-identifier">pcoptions</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">o</span><span class="ruby-operator">|</span> <span class="ruby-node">&quot;--#{o}&quot;</span> }
  <span class="ruby-identifier">response</span> = <span class="ruby-constant">IO</span>.<span class="ruby-identifier">popen</span>([<span class="ruby-identifier">pkgconfig</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">pcoptions</span>, <span class="ruby-identifier">pkg</span>], <span class="ruby-value">err:</span>[<span class="ruby-value">:child</span>, <span class="ruby-value">:out</span>], <span class="ruby-operator">&amp;</span><span class="ruby-value">:read</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">RuntimeError</span>, <span class="ruby-identifier">response</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">$?</span>.<span class="ruby-identifier">success?</span>
  <span class="ruby-identifier">response</span>.<span class="ruby-identifier">strip</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-native_path" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">native_path</span><span
            class="method-args">(path)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="native_path-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 390</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">native_path</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-constant">MiniPortile</span>.<span class="ruby-identifier">native_path</span>(<span class="ruby-identifier">path</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-newer-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">newer?</span><span
            class="method-args">(target, checkpoint)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="newer-3F-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 628</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">newer?</span>(<span class="ruby-identifier">target</span>, <span class="ruby-identifier">checkpoint</span>)
  <span class="ruby-keyword">if</span> (<span class="ruby-identifier">target</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">target</span>)) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">checkpoint</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">checkpoint</span>))
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">mtime</span>(<span class="ruby-identifier">target</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">mtime</span>(<span class="ruby-identifier">checkpoint</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-output" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">output</span><span
            class="method-args">(text = &quot;&quot;)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>print out a message using the logger but return to a new line</p>
          
          

          
          <div class="method-source-code" id="output-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 643</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">output</span>(<span class="ruby-identifier">text</span> = <span class="ruby-string">&quot;&quot;</span>)
  <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">text</span>
  <span class="ruby-ivar">@logger</span>.<span class="ruby-identifier">flush</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-port_path" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">port_path</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="port_path-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 402</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">port_path</span>
  <span class="ruby-node">&quot;#{@target}/#{@host}/#{@name}/#{@version}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-posix_path" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">posix_path</span><span
            class="method-args">(path)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="posix_path-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 394</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">posix_path</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-constant">MiniPortile</span>.<span class="ruby-identifier">posix_path</span>(<span class="ruby-identifier">path</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-tar_command" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">tar_command</span><span
            class="method-args">(file, target)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="tar_command-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 556</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">tar_command</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">target</span>)
  <span class="ruby-keyword">case</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">extname</span>(<span class="ruby-identifier">file</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;.gz&#39;</span>, <span class="ruby-string">&#39;.tgz&#39;</span>
      [<span class="ruby-identifier">tar_exe</span>, <span class="ruby-string">&#39;xzf&#39;</span>, <span class="ruby-identifier">file</span>, <span class="ruby-string">&#39;-C&#39;</span>, <span class="ruby-identifier">target</span>]
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;.bz2&#39;</span>, <span class="ruby-string">&#39;.tbz2&#39;</span>
      [<span class="ruby-identifier">tar_exe</span>, <span class="ruby-string">&#39;xjf&#39;</span>, <span class="ruby-identifier">file</span>, <span class="ruby-string">&#39;-C&#39;</span>, <span class="ruby-identifier">target</span>]
    <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;.xz&#39;</span>
      <span class="ruby-comment"># NOTE: OpenBSD&#39;s tar command does not support the -J option</span>
      <span class="ruby-node">&quot;xzcat #{file.shellescape} | #{tar_exe.shellescape} xf - -C #{target.shellescape}&quot;</span>
    <span class="ruby-keyword">else</span>
      [<span class="ruby-identifier">tar_exe</span>, <span class="ruby-string">&#39;xf&#39;</span>, <span class="ruby-identifier">file</span>, <span class="ruby-string">&#39;-C&#39;</span>, <span class="ruby-identifier">target</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-tar_exe" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">tar_exe</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="tar_exe-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 548</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">tar_exe</span>
  <span class="ruby-identifier">@@tar_exe</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword">begin</span>
    <span class="ruby-constant">TAR_EXECUTABLES</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">which</span>(<span class="ruby-identifier">c</span>)
    } <span class="ruby-keyword">or</span> <span class="ruby-identifier">raise</span>(<span class="ruby-node">&quot;tar not found - please make sure that one of the following commands is in the PATH: #{TAR_EXECUTABLES.join(&quot;, &quot;)}&quot;</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-tmp_path" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">tmp_path</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="tmp_path-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 398</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">tmp_path</span>
  <span class="ruby-node">&quot;tmp/#{@host}/ports/#{@name}/#{@version}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-verify_file" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">verify_file</span><span
            class="method-args">(file)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="verify_file-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 453</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">verify_file</span>(<span class="ruby-identifier">file</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-value">:gpg</span>)
    <span class="ruby-identifier">gpg</span> = <span class="ruby-identifier">file</span>[<span class="ruby-value">:gpg</span>]

    <span class="ruby-identifier">signature_url</span> = <span class="ruby-identifier">gpg</span>[<span class="ruby-value">:signature_url</span>] <span class="ruby-operator">||</span> <span class="ruby-node">&quot;#{file[:url]}.asc&quot;</span>
    <span class="ruby-identifier">signature_file</span> = <span class="ruby-identifier">file</span>[<span class="ruby-value">:local_path</span>] <span class="ruby-operator">+</span> <span class="ruby-string">&quot;.asc&quot;</span>
    <span class="ruby-comment"># download the signature file</span>
    <span class="ruby-identifier">download_file</span>(<span class="ruby-identifier">signature_url</span>, <span class="ruby-identifier">signature_file</span>)

    <span class="ruby-identifier">gpg_exe</span> = <span class="ruby-identifier">which</span>(<span class="ruby-string">&#39;gpg2&#39;</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">which</span>(<span class="ruby-string">&#39;gpg&#39;</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">raise</span>(<span class="ruby-string">&quot;Neither GPG nor GPG2 is installed&quot;</span>)

    <span class="ruby-comment"># import the key into our own keyring</span>
    <span class="ruby-identifier">gpg_error</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">gpg_status</span> = <span class="ruby-constant">Open3</span>.<span class="ruby-identifier">popen3</span>(<span class="ruby-identifier">gpg_exe</span>, <span class="ruby-string">&quot;--status-fd&quot;</span>, <span class="ruby-string">&quot;1&quot;</span>, <span class="ruby-string">&quot;--no-default-keyring&quot;</span>, <span class="ruby-string">&quot;--keyring&quot;</span>, <span class="ruby-constant">KEYRING_NAME</span>, <span class="ruby-string">&quot;--import&quot;</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">gpg_in</span>, <span class="ruby-identifier">gpg_out</span>, <span class="ruby-identifier">gpg_err</span>, <span class="ruby-identifier">_thread</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">gpg_in</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">gpg</span>[<span class="ruby-value">:key</span>]
      <span class="ruby-identifier">gpg_in</span>.<span class="ruby-identifier">close</span>
      <span class="ruby-identifier">gpg_error</span> = <span class="ruby-identifier">gpg_err</span>.<span class="ruby-identifier">read</span>
      <span class="ruby-identifier">gpg_out</span>.<span class="ruby-identifier">read</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">key_ids</span> = <span class="ruby-identifier">gpg_status</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\[GNUPG:\] IMPORT_OK \d+ (?&lt;key_id&gt;[0-9a-f]+)/i</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:first</span>)
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;invalid gpg key provided:\n#{gpg_error}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">key_ids</span>.<span class="ruby-identifier">empty?</span>

    <span class="ruby-keyword">begin</span>
      <span class="ruby-comment"># verify the signature against our keyring</span>
      <span class="ruby-identifier">gpg_status</span>, <span class="ruby-identifier">gpg_error</span>, <span class="ruby-identifier">_status</span> = <span class="ruby-constant">Open3</span>.<span class="ruby-identifier">capture3</span>(<span class="ruby-identifier">gpg_exe</span>, <span class="ruby-string">&quot;--status-fd&quot;</span>, <span class="ruby-string">&quot;1&quot;</span>, <span class="ruby-string">&quot;--no-default-keyring&quot;</span>, <span class="ruby-string">&quot;--keyring&quot;</span>, <span class="ruby-constant">KEYRING_NAME</span>, <span class="ruby-string">&quot;--verify&quot;</span>, <span class="ruby-identifier">signature_file</span>, <span class="ruby-identifier">file</span>[<span class="ruby-value">:local_path</span>])

      <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;signature mismatch:\n#{gpg_error}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">gpg_status</span>.<span class="ruby-identifier">match</span>(<span class="ruby-regexp">/^\[GNUPG:\] VALIDSIG/</span>)
    <span class="ruby-keyword">ensure</span>
      <span class="ruby-comment"># remove the key from our keyring</span>
      <span class="ruby-identifier">key_ids</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key_id</span><span class="ruby-operator">|</span>
        <span class="ruby-constant">IO</span>.<span class="ruby-identifier">popen</span>([<span class="ruby-identifier">gpg_exe</span>, <span class="ruby-string">&quot;--batch&quot;</span>, <span class="ruby-string">&quot;--yes&quot;</span>, <span class="ruby-string">&quot;--no-default-keyring&quot;</span>, <span class="ruby-string">&quot;--keyring&quot;</span>, <span class="ruby-constant">KEYRING_NAME</span>, <span class="ruby-string">&quot;--delete-keys&quot;</span>, <span class="ruby-identifier">key_id</span>], <span class="ruby-operator">&amp;</span><span class="ruby-value">:read</span>)
        <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;unable to delete the imported key&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">$?</span>.<span class="ruby-identifier">exitstatus</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>


  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">digest</span> = <span class="ruby-keyword">case</span>
      <span class="ruby-keyword">when</span> <span class="ruby-identifier">exp</span>=<span class="ruby-identifier">file</span>[<span class="ruby-value">:sha256</span>] <span class="ruby-keyword">then</span> <span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">SHA256</span>
      <span class="ruby-keyword">when</span> <span class="ruby-identifier">exp</span>=<span class="ruby-identifier">file</span>[<span class="ruby-value">:sha1</span>] <span class="ruby-keyword">then</span> <span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">SHA1</span>
      <span class="ruby-keyword">when</span> <span class="ruby-identifier">exp</span>=<span class="ruby-identifier">file</span>[<span class="ruby-value">:md5</span>] <span class="ruby-keyword">then</span> <span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">MD5</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">digest</span>
      <span class="ruby-identifier">is</span> = <span class="ruby-identifier">digest</span>.<span class="ruby-identifier">file</span>(<span class="ruby-identifier">file</span>[<span class="ruby-value">:local_path</span>]).<span class="ruby-identifier">hexdigest</span>
      <span class="ruby-keyword">unless</span> <span class="ruby-identifier">is</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">exp</span>.<span class="ruby-identifier">downcase</span>
        <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Downloaded file &#39;#{file[:local_path]}&#39; has wrong hash: expected: #{exp} is: #{is}&quot;</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-which" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">which</span><span
            class="method-args">(cmd)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>From: <a href="http://stackoverflow.com/a/5471032/7672">stackoverflow.com/a/5471032/7672</a> Thanks, Mislav!</p>

<p>Cross-platform way of finding an executable in the $PATH.</p>

<pre class="ruby"><span class="ruby-identifier">which</span>(<span class="ruby-string">&#39;ruby&#39;</span>) <span class="ruby-comment">#=&gt; /usr/bin/ruby</span>
</pre>
          
          

          
          <div class="method-source-code" id="which-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 517</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">which</span>(<span class="ruby-identifier">cmd</span>)
  <span class="ruby-identifier">exts</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;PATHEXT&#39;</span>] <span class="ruby-operator">?</span> <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;PATHEXT&#39;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;;&#39;</span>) <span class="ruby-operator">:</span> [<span class="ruby-string">&#39;&#39;</span>]
  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;PATH&#39;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">PATH_SEPARATOR</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">exts</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">ext</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">exe</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">path</span>, <span class="ruby-node">&quot;#{cmd}#{ext}&quot;</span>)
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">exe</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">executable?</span> <span class="ruby-identifier">exe</span>
    }
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-with_tempfile" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">with_tempfile</span><span
            class="method-args">(filename, full_path) { |temp_file| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="with_tempfile-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 761</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">with_tempfile</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">full_path</span>)
  <span class="ruby-identifier">temp_file</span> = <span class="ruby-constant">Tempfile</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;download-#{filename}&quot;</span>)
  <span class="ruby-identifier">temp_file</span>.<span class="ruby-identifier">binmode</span>
  <span class="ruby-keyword">yield</span> <span class="ruby-identifier">temp_file</span>
  <span class="ruby-identifier">temp_file</span>.<span class="ruby-identifier">close</span>
  <span class="ruby-constant">File</span>.<span class="ruby-identifier">unlink</span> <span class="ruby-identifier">full_path</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">full_path</span>)
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">full_path</span>)
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mv</span> <span class="ruby-identifier">temp_file</span>.<span class="ruby-identifier">path</span>, <span class="ruby-identifier">full_path</span>, <span class="ruby-value">:force</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-work_path" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">work_path</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="work_path-source">
            <pre><span class="ruby-comment"># File lib/mini_portile2/mini_portile.rb, line 410</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">work_path</span>
  <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-node">&quot;#{tmp_path}/*&quot;</span>).<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">d</span>) }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>

</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.1.2.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

